"use strict";var __assign=this&&this.__assign||function(){__assign=Object.assign||function(e){for(var r,t=1,n=arguments.length;t<n;t++){r=arguments[t];for(var s in r)if(Object.prototype.hasOwnProperty.call(r,s))e[s]=r[s]}return e};return __assign.apply(this,arguments)};var __awaiter=this&&this.__awaiter||function(e,i,t,a){function u(r){return r instanceof t?r:new t(function(e){e(r)})}return new(t||(t=Promise))(function(r,t){function n(e){try{o(a.next(e))}catch(e){t(e)}}function s(e){try{o(a["throw"](e))}catch(e){t(e)}}function o(e){e.done?r(e.value):u(e.value).then(n,s)}o((a=a.apply(e,i||[])).next())})};var __generator=this&&this.__generator||function(e,t){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},s,o,i,r;return r={next:a(0),throw:a(1),return:a(2)},typeof Symbol==="function"&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(e){return u([r,e])}}function u(r){if(s)throw new TypeError("Generator is already executing.");while(n)try{if(s=1,o&&(i=r[0]&2?o["return"]:r[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,r[1])).done)return i;if(o=0,i)r=[r[0]&2,i.value];switch(r[0]){case 0:case 1:i=r;break;case 4:n.label++;return{value:r[1],done:false};case 5:n.label++;o=r[1];r=[0];continue;case 7:r=n.ops.pop();n.trys.pop();continue;default:if(!(i=n.trys,i=i.length>0&&i[i.length-1])&&(r[0]===6||r[0]===2)){n=0;continue}if(r[0]===3&&(!i||r[1]>i[0]&&r[1]<i[3])){n.label=r[1];break}if(r[0]===6&&n.label<i[1]){n.label=i[1];i=r;break}if(i&&n.label<i[2]){n.label=i[2];n.ops.push(r);break}if(i[2])n.ops.pop();n.trys.pop();continue}r=t.call(e,n)}catch(e){r=[6,e];o=0}finally{s=i=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});exports.gql=exports.GraphqlMiniApp=void 0;var GraphqlMiniApp=function(){function e(e,r,t){var n=this;this.interceptors={request:{use:function(e,r){return n._addInterceptors(e,r,"request")},eject:function(e){if(!e){console.error("请传入拦截器对象");return}var r=n.requestInterceptors;var t=n.requestInterceptorsError;r.splice(e.index,1,function(e){return e});t.splice(e.errIndex,1,function(e){});n.requestInterceptors=r;n.requestInterceptorsError=t}},response:{use:function(e,r){return n._addInterceptors(e,r,"response")},eject:function(e){if(!e){console.error("请传入拦截器对象");return}var r=n.responseInterceptors;var t=n.responseInterceptorsError;r.splice(e.index,1,function(e,r,t){return e});t.splice(e.errIndex,1,function(e){});n.responseInterceptors=r;n.responseInterceptorsError=t}}};this.url=e;this.options=r||{};this.errorHandler=t||undefined;this.requestTask=null;this.requestInterceptors=[];this.requestInterceptorsError=[];this.responseInterceptors=[];this.responseInterceptorsError=[];var s=false;var o=false;var i=wx.showLoading,a=wx.hideLoading,u=wx.showToast,c=wx.hideToast;Object.defineProperty(wx,"showLoading",{configurable:true,enumerable:true,writable:true,value:function(){var e=[];for(var r=0;r<arguments.length;r++){e[r]=arguments[r]}if(o){return}s=true;return i.apply(this,e)}});Object.defineProperty(wx,"hideLoading",{configurable:true,enumerable:true,writable:true,value:function(){var e=[];for(var r=0;r<arguments.length;r++){e[r]=arguments[r]}if(o){return}s=false;return a.apply(this,e)}});Object.defineProperty(wx,"showToast",{configurable:true,enumerable:true,writable:true,value:function(){var e=[];for(var r=0;r<arguments.length;r++){e[r]=arguments[r]}if(s){wx.hideLoading()}o=true;return u.apply(this,e)}});Object.defineProperty(wx,"hideToast",{configurable:true,enumerable:true,writable:true,value:function(){var e=[];for(var r=0;r<arguments.length;r++){e[r]=arguments[r]}o=false;return c.apply(this,e)}})}e.prototype._addInterceptors=function(e,r,t){if(t===void 0){t=""}switch(t){case"request":var n=this.requestInterceptors.push(e);var s=this.requestInterceptorsError.push(r);return{index:n-1,errIndex:s-1};case"response":var o=this.responseInterceptors.push(e);var i=this.responseInterceptorsError.push(r);return{index:o-1,errIndex:i-1};default:throw"未知拦截器类型"}};e.prototype.offHeadersReceived=function(e){this.requestTask.offHeadersReceived(e)};e.prototype.onHeadersReceived=function(e){this.requestTask.onHeadersReceived(e)};e.prototype.abort=function(){this.requestTask.abort()};e.prototype.request=function(r){return __awaiter(this,void 0,void 0,function(){var s;var o=this;return __generator(this,function(e){switch(e.label){case 0:if(!this.url&&r.baseURL===""){throw"缺少请求url"}s=__assign(__assign({},this.options),r);return[4,new Promise(function(t,n){var r={baseURL:"",method:"GET",headers:undefined,query:"",graphql:true,mutation:"",uri:"",variables:undefined};if(o.requestInterceptors.length>=1){o.requestInterceptors.forEach(function(e){Object.assign(r,e(s))})}else{r=__assign(__assign({},r),s)}var e=null;if(r.graphql){e=JSON.stringify({query:r.query===""?r.mutation:r.query,variables:r.variables})}else{e=r.data}o.requestTask=wx.request({url:r.baseURL===""?o.url+r.uri:r.baseURL+r.uri,method:r.method,data:e,header:r.headers,success:function(r){if(r.statusCode===200){if(o.responseInterceptors.length>=1){o.responseInterceptors.forEach(function(e){Object.assign(r,e(r,t,n))})}t(r)}else{if(o.responseInterceptorsError.length>=1&&o.responseInterceptorsError[0]!==undefined){o.responseInterceptorsError.forEach(function(e){e(r)})}if(o.errorHandler){o.errorHandler(r)}n(r)}},fail:function(r){if(r.errMsg.indexOf("request:fail")>=0&&o.requestInterceptorsError.length>=1&&o.requestInterceptorsError[0]!==undefined){o.requestInterceptorsError.forEach(function(e){e(r)})}else if(o.responseInterceptorsError.length>=1&&o.responseInterceptorsError[0]!==undefined){o.responseInterceptorsError.forEach(function(e){e(r)})}if(o.errorHandler){o.errorHandler(r)}n(r)},complete:function(e){wx.hideLoading()}})})];case 1:return[2,e.sent()]}})})};return e}();exports.GraphqlMiniApp=GraphqlMiniApp;function gql(e){return e[0]}exports.gql=gql;